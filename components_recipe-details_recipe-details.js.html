<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>components/recipe-details/recipe-details.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Database.html">Database</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#deleteRecipe">deleteRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#getRecipe">getRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#getRecipes">getRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#pushRecipe">pushRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#searchByName">searchByName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#updateRecipe">updateRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#writeData">writeData</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="HomePage.html">HomePage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="HomePage.html#createRecipeCard">createRecipeCard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="HomePage.html#setupElement">setupElement</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RecipeContribute.html">RecipeContribute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeContribute.html#addRecipe">addRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeContribute.html#editRecipe">editRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeContribute.html#getVideoEmbedURL">getVideoEmbedURL</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeContribute.html#saveRecipe">saveRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeContribute.html#setupElement">setupElement</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RecipeDetails.html">RecipeDetails</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeDetails.html#setTime">setTime</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeDetails.html#setupElement">setupElement</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeDetails.html#timedCount">timedCount</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Storage.html">Storage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Storage.html#deleteImage">deleteImage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Storage.html#uploadImage">uploadImage</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="YummyRecipesComponent_YummyRecipesComponent.html">YummyRecipesComponent</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-core_routing_router.html">core/routing/router</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-core_routing_router.html#~getParamsFromUrl">getParamsFromUrl</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-core_routing_router.html#~getRoutefromUrl">getRoutefromUrl</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-core_routing_router.html#~getUrlFromRoute">getUrlFromRoute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-core_routing_router.html#~loadRoute">loadRoute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-core_routing_router.html#~navigateFromUrl">navigateFromUrl</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-core_routing_router.html#~routerSetup">routerSetup</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">components/recipe-details/recipe-details.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { Database } from "/core/database/database.js";
import { Storage } from "/core/storage/storage.js";
import { YummyRecipesComponent } from "/components/core/yummy-recipes-component.js";

/** Class that provides functionality to the recipe details page. */
class RecipeDetails extends YummyRecipesComponent {
  constructor() {
    super();
    this.htmlPath = "components/recipe-details/recipe-details.html";
  }
  count = 0;
  timeoutID;
  timeron = 0;
  /**
   * Populates recipe details page with information from the database and adds
   * delete functionality.
   *
   * @async
   */
  async setupElement() {
    this.shadowRoot
      .getElementById("hands-free-button")
      .addEventListener("click", () => {
        const routerEvent = new CustomEvent("router-navigate", {
          detail: {
            route: "hands-free",
            params: [this.routeParams[0]],
          },
          bubbles: true,
          composed: true,
        });
        document.dispatchEvent(routerEvent);
      });
    this.shadowRoot
      .getElementById("timer-button")
      .addEventListener("click", () => {
        if (this.shadowRoot.getElementById("timer").style.display == "") {
          this.shadowRoot.getElementById("timer").style.display = "flex";
        } else {
          this.shadowRoot.getElementById("timer").style.display = "";
        }
      });
    this.shadowRoot
      .getElementById("start-button")
      .addEventListener("click", () => {
        if (!this.timeron) {
          this.timeron = 1;
          this.timedCount();
          this.shadowRoot.getElementById("start-button").innerHTML = "Stop";
        } else {
          this.shadowRoot.getElementById("start-button").innerHTML = "Start";
          clearTimeout(this.timeoutID);
          this.timeron = 0;
        }
      });
    this.shadowRoot
      .getElementById("reset-button")
      .addEventListener("click", () => {
        clearTimeout(this.timeoutID);
        this.timeron = 0;
        this.count = 0;
        this.setTime();
      });

    // Grab recipe from database based on routing parameter
    const database = new Database();
    let recipes = await database.getRecipes();
    let recipe = recipes[this.routeParams[0]];

    // If recipe does not exist, then route back to home page
    if (!recipe) {
      const routerEvent = new CustomEvent("router-navigate", {
        detail: {
          route: "home-page",
          params: [],
        },
        bubbles: true,
        composed: true,
      });
      document.dispatchEvent(routerEvent);
      return;
    }

    // Recipe edit button
    this.shadowRoot
      .querySelector("#edit-button")
      .addEventListener("click", () => {
        // Route to edit page
        const routerEvent = new CustomEvent("router-navigate", {
          detail: {
            route: "recipe-contribute-edit",
            params: [this.routeParams[0]],
          },
          bubbles: true,
          composed: true,
        });
        document.dispatchEvent(routerEvent);
      });

    // Recipe delete button
    this.shadowRoot
      .querySelector("#delete-button")
      .addEventListener("click", () => {
        if (confirm("Are you sure you want to delete this recipe?")) {
          // Get recipe index in database from route param
          const index = this.routeParams[0];

          // Delete recipe in database
          database.deleteRecipe(index);

          // Delete recipe image
          const storage = new Storage();
          storage.deleteImage(index);

          // Route to home-page
          const routerEvent = new CustomEvent("router-navigate", {
            detail: {
              route: "home-page",
              params: [],
            },
            bubbles: true,
            composed: true,
          });
          document.dispatchEvent(routerEvent);

          // Notify user that recipe was deleted
          alert("Recipe deleted");
        }
      });

    // Display recipe video if the recipe has a link
    if (recipe.metadata.video != undefined &amp;&amp; recipe.metadata.video != "") {
      this.shadowRoot.getElementById("recipe-video").style.display = "block";
      this.shadowRoot.getElementById("recipe-video").src =
        recipe.metadata.video;
    }

    // This is the first row of the page, including the image and the author box
    this.shadowRoot.querySelector(".recipe-image").src = recipe.metadata.image;
    this.shadowRoot.querySelector(".recipe-image").alt = recipe.metadata.title;
    this.shadowRoot.querySelector(".dish-name").innerHTML =
      recipe.metadata.title;
    this.shadowRoot.querySelector(".author-name").innerHTML =
      recipe.metadata.author;
    this.shadowRoot.querySelector(".recipe-url").innerHTML =
      recipe.spoonacularSourceUrl;

    // Description box
    this.shadowRoot.querySelector(".description").innerHTML =
      recipe.description;

    // Information box
    this.shadowRoot.querySelector("#cost").innerHTML =
      recipe.info.pricePerServings;
    this.shadowRoot.querySelector("#time").innerHTML =
      recipe.info.readyInMinutes;
    this.shadowRoot.querySelector("#servings").innerHTML =
      recipe.nutrients.totalServings;

    // Category box
    if (!recipe.categories.vegan) {
      this.shadowRoot.querySelector("#vegan").style.display = "none";
    }
    if (!recipe.categories.vegetarian) {
      this.shadowRoot.querySelector("#vegetarian").style.display = "none";
    }
    if (!recipe.categories.glutenFree) {
      this.shadowRoot.querySelector("#gluten-free").style.display = "none";
    }
    if (!recipe.categories.highProtein) {
      this.shadowRoot.querySelector("#high-protein").style.display = "none";
    }
    if (!recipe.categories.healthy) {
      this.shadowRoot.querySelector("#healthy").style.display = "none";
    }

    // Nutrient box
    this.shadowRoot.querySelector("#calories").innerHTML =
      recipe.nutrients.calories;
    this.shadowRoot.querySelector("#fat").innerHTML = recipe.nutrients.fat;
    this.shadowRoot.querySelector("#protein").innerHTML =
      recipe.nutrients.protein;

    // Ingredients box
    let ingredients = "";

    for (let i = 0; i &lt; recipe.ingredients.length; i++) {
      ingredients += "&lt;li>" + recipe.ingredients[i] + "&lt;/li>";
    }

    this.shadowRoot.querySelector(".ingredients-list").innerHTML =
      "&lt;ul>" + ingredients + "&lt;/ul>";

    // Direction box
    let directions = "";

    for (let i = 0; i &lt; recipe.steps.length; i++) {
      directions += "&lt;li>" + recipe.steps[i] + "&lt;/li>";
    }

    this.shadowRoot.querySelector(".direction-list").innerHTML =
      "&lt;ol>" + directions + "&lt;/ol>";
  }
  /**
   * help function for timer
   */
  timedCount() {
    this.setTime();
    this.count = this.count + 1;
    this.timeoutID = setTimeout(this.timedCount.bind(this), 1000);
  }

  /**
   * set timer
   */
  setTime() {
    let hour = parseInt(this.count / 3600, 10);
    let minute = parseInt(this.count / 60, 10);
    let second = parseInt(this.count % 60, 10);
    if (hour &lt; 10) {
      hour = "0" + hour;
    }
    if (minute &lt; 10) {
      minute = "0" + minute;
    }
    if (second &lt; 10) {
      second = "0" + second;
    }
    this.shadowRoot.getElementById("timer-display").innerText =
      hour + ":" + minute + ":" + second;
  }
}

customElements.define("recipe-details", RecipeDetails);
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Sun Dec 05 2021 11:35:33 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
