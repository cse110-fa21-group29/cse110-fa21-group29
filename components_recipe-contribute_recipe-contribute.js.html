<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>components/recipe-contribute/recipe-contribute.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Book.html">Book</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Database.html">Database</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#deleteRecipe">deleteRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#getRecipes">getRecipes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#pushRecipe">pushRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Database.html#updateRecipe">updateRecipe</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="HomePage.html">HomePage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="HomePage.html#setupElement">setupElement</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RecipeContribute.html">RecipeContribute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeContribute.html#addRecipe">addRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeContribute.html#editRecipe">editRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeContribute.html#saveRecipe">saveRecipe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeContribute.html#setupElement">setupElement</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RecipeDetails.html">RecipeDetails</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeDetails.html#setTime">setTime</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeDetails.html#setupElement">setupElement</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RecipeDetails.html#timedCount">timedCount</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="YummyRecipesComponent_YummyRecipesComponent.html">YummyRecipesComponent</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-core_routing_router.html">core/routing/router</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-core_routing_router.html#~getParamsFromUrl">getParamsFromUrl</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-core_routing_router.html#~getRoutefromUrl">getRoutefromUrl</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-core_routing_router.html#~getUrlFromRoute">getUrlFromRoute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-core_routing_router.html#~loadRoute">loadRoute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-core_routing_router.html#~navigateFromUrl">navigateFromUrl</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-core_routing_router.html#~routerSetup">routerSetup</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">components/recipe-contribute/recipe-contribute.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { Database } from "../../core/database/database.js";
import { YummyRecipesComponent } from "/components/core/yummy-recipes-component.js";

/** Class that provides functionality to the recipe contribute page. */
class RecipeContribute extends YummyRecipesComponent {
  constructor() {
    super();
    this.htmlPath = "components/recipe-contribute/recipe-contribute.html";
  }

  /**
   * Sets up contribute page functionality depending on if creating or updating
   * recipe.
   *
   * @async
   */
  async setupElement() {
    // Set up page for adding recipe or editing recipe depending on route
    if (this.routeName === "recipe-contribute-add") {
      this.addRecipe();
    } else {
      this.editRecipe();
    }
  }

  uploadImg(event) {
    this.shadowRoot.getElementById("submit-img").style.backgroundImage =
      "url(" + URL.createObjectURL(event.target.files[0]) + ")";
  }

  /**
   * Sets up the page for adding a new recipe.
   *
   * @async
   */
  async addRecipe() {
    // Empty object that will get populated using form values
    const recipe = {
      metadata: {
        id: -1,
        title: "",
        author: "",
        image: "static/common/demorecipe.jpg",
      },
      info: {
        readyInMinutes: 0,
        pricePerServings: 0,
        weightWatcherSmartPoints: 0,
        healthScore: 100,
      },
      categories: {
        vegan: false,
        vegetarian: false,
        glutenFree: false,
        highProtein: false,
        healthy: false,
      },
      nutrients: {
        totalServings: 0,
        calories: 0,
        protein: "",
        fat: "",
      },
      description: "",
      ingredients: [],
      steps: "",
      spoonacularSourceUrl: "",
    };

    // Assign saveRecipe function to submit button
    this.shadowRoot
      .querySelector("#submit-button")
      .addEventListener("click", (e) => {
        this.saveRecipe(recipe, true);
        e.preventDefault();
      });
  }

  /**
   * Sets up the page for editing an existing recipe.
   *
   * @async
   */
  async editRecipe() {
    // Get recipe from database
    const db = new Database();
    const recipes = await db.getRecipes();
    const recipe = recipes[this.routeParams[0]];

    // Display current recipe image
    this.shadowRoot.getElementById("submit-img").style.backgroundImage =
      "url(" + recipe.metadata.image + ")";

    // Pre-populate form with nutrients
    this.shadowRoot.querySelector("#input-number-of-servings").value =
      recipe.nutrients.totalServings;
    this.shadowRoot.querySelector("#input-colories").value =
      recipe.nutrients.calories;
    this.shadowRoot.querySelector("#input-protein").value =
      recipe.nutrients.protein.slice(0, -1);
    this.shadowRoot.querySelector("#input-fat").value =
      recipe.nutrients.fat.slice(0, -1);

    // Pre-populate form with categories
    this.shadowRoot.querySelector("#input-vegan").checked =
      recipe.categories.vegan;
    this.shadowRoot.querySelector("#input-vegetarian").checked =
      recipe.categories.vegetarian;
    this.shadowRoot.querySelector("#input-gluten-free").checked =
      recipe.categories.glutenFree;
    this.shadowRoot.querySelector("#input-healthy").checked =
      recipe.categories.healthy;
    this.shadowRoot.querySelector("#input-high-protein").checked =
      recipe.categories.highProtein;

    // Pre-populate form with general information
    this.shadowRoot.querySelector("#input-recipe-title").value =
      recipe.metadata.title;
    this.shadowRoot.querySelector("#input-author").value =
      recipe.metadata.author;
    this.shadowRoot.querySelector("#input-time").value =
      recipe.info.readyInMinutes;
    this.shadowRoot.querySelector("#input-cost").value =
      recipe.info.pricePerServings;

    // Pre-populate form with description
    this.shadowRoot.querySelector("#input-description").innerText =
      recipe.description;

    // Pre-populate form with ingredients
    const ingredients = recipe.ingredients.join("\n");
    this.shadowRoot.querySelector("#input-ingredient").innerHTML = ingredients;

    // Pre-populate form with directions
    const stepsArr = recipe.steps.split("&lt;/li>");

    for (let i = 0; i &lt; stepsArr.length; i++) {
      stepsArr[i] = stepsArr[i].replace(/(&lt;([^>]+)>)/gi, "");
    }

    const steps = stepsArr.join("\n");

    this.shadowRoot.querySelector("#input-direction").innerHTML = steps;

    // Update edited recipe in database on submit button click
    this.shadowRoot
      .querySelector("#submit-button")
      .addEventListener("click", (e) => {
        this.saveRecipe(recipe, false);
        e.preventDefault();
      });
  }

  /**
   * Grabs form values, updates recipe object, then pushes object to database.
   * The add parameter should be true if you are adding a new recipe or false
   * if you are updating an existing recipe.
   *
   * @param {Object} recipe - an object that contains the recipe data
   * @param {boolean} add - toggles between creating and updating recipe
   */
  async saveRecipe(recipe, add) {
    // Nutrients
    recipe.nutrients.totalServings = this.shadowRoot.querySelector(
      "#input-number-of-servings"
    ).value;
    recipe.nutrients.calories =
      this.shadowRoot.querySelector("#input-colories").value;
    recipe.nutrients.protein =
      this.shadowRoot.querySelector("#input-protein").value + "g";
    recipe.nutrients.fat =
      this.shadowRoot.querySelector("#input-fat").value + "g";

    // Categories
    recipe.categories.vegan =
      this.shadowRoot.querySelector("#input-vegan").checked;
    recipe.categories.vegetarian =
      this.shadowRoot.querySelector("#input-vegetarian").checked;
    recipe.categories.glutenFree =
      this.shadowRoot.querySelector("#input-gluten-free").checked;
    recipe.categories.highProtein = this.shadowRoot.querySelector(
      "#input-high-protein"
    ).checked;
    recipe.categories.healthy =
      this.shadowRoot.querySelector("#input-healthy").checked;

    // Recipe General Information
    recipe.metadata.title = this.shadowRoot.querySelector(
      "#input-recipe-title"
    ).value;
    recipe.metadata.author =
      this.shadowRoot.querySelector("#input-author").value;
    recipe.info.readyInMinutes =
      this.shadowRoot.querySelector("#input-time").value;
    recipe.info.pricePerServings =
      this.shadowRoot.querySelector("#input-cost").value;

    // Description
    recipe.description =
      this.shadowRoot.querySelector("#input-description").value;

    // Ingredients
    const ingredients = this.shadowRoot
      .querySelector("#input-ingredient")
      .value.split("\n");
    recipe.ingredients = ingredients;

    // Directions
    const steps = this.shadowRoot
      .querySelector("#input-direction")
      .value.split("\n");

    recipe.steps = "&lt;ol>";

    for (let i = 0; i &lt; steps.length; i++) {
      recipe.steps = recipe.steps + "&lt;li>" + steps[i] + "&lt;/li>";
    }

    recipe.steps = recipe.steps + "&lt;/ol>";

    // Call database functions based on if add or edit function is specified
    const db = new Database();

    if (add == true) {
      // Push recipe to database and grab index of the new recipe
      const index = await db.pushRecipe(recipe);

      // Route to new recipe page
      const routerEvent = new CustomEvent("router-navigate", {
        detail: {
          route: "recipe-details",
          params: [index],
        },
        bubbles: true,
        composed: true,
      });

      document.dispatchEvent(routerEvent);
    } else {
      // Push edited recipe to database
      await db.updateRecipe(recipe, this.routeParams[0]);

      // Route to edited recipe page
      const routerEvent = new CustomEvent("router-navigate", {
        detail: {
          route: "recipe-details",
          params: [this.routeParams[0]],
        },
        bubbles: true,
        composed: true,
      });

      document.dispatchEvent(routerEvent);
    }
  }
}

customElements.define("recipe-contribute", RecipeContribute);
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Sat Nov 27 2021 23:57:42 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
